document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("myForm");if(!e)return;!function(e=".js-name"){const t=document.querySelectorAll(e);if(!t.length)return;const a=/[^\p{L}\p{M}\s'’-]/gu,n=/[^A-Za-z\s'’-]/g,r=e=>{if(null==e)return"";let t=e.normalize?e.normalize("NFC"):e;try{t=t.replace(a,"")}catch{t=t.replace(n,"")}return t.replace(/\s{2,}/g," ")},s=(e,t)=>{const a=e.selectionStart??e.value.length,n=e.selectionEnd??e.value.length;e.value=e.value.slice(0,a)+t+e.value.slice(n);const r=a+t.length;try{e.setSelectionRange(r,r)}catch{}e.dispatchEvent(new Event("input",{bubbles:!0}))};t.forEach((e=>{e.setAttribute("inputmode","text"),e.setAttribute("autocomplete",e.id?.toLowerCase().includes("last")?"family-name":"given-name"),e.addEventListener("beforeinput",(e=>{if(!e.data)return;r(e.data)!==e.data&&e.preventDefault()})),e.addEventListener("input",(()=>{const t=r(e.value);if(e.value!==t){const a=e.selectionStart??t.length,n=e.value.length-t.length;e.value=t;try{e.setSelectionRange(Math.max(0,a-n),Math.max(0,a-n))}catch{}}})),e.addEventListener("paste",(t=>{t.preventDefault();const a=(t.clipboardData||window.clipboardData).getData("text");s(e,r(a))})),e.addEventListener("drop",(t=>{t.preventDefault();const a=t.dataTransfer?.getData("text")??"";s(e,r(a))}))}))}(),e.setAttribute("novalidate","");let t=!1;const a=Array.from(e.querySelectorAll("input, textarea, select"));function n(e){e.classList.add("is-invalid"),e.setAttribute("aria-invalid","true"),function(e,t="Please fill out this field."){const a=e.closest(".mb-3, .form-group")||e.parentElement;if(!a)return null;let n=a.querySelector(".invalid-feedback");n||(n=document.createElement("div"),n.className="invalid-feedback",a.appendChild(n));const r="email"===e.type?"Please enter a valid email address.":"tel"===e.type?"Please enter a valid mobile number.":"SELECT"===e.tagName?"Please choose an option.":t;n.textContent=r}(e)}function r(e,{from:a=""}={}){if(e.disabled||e.readOnly)return;if("checkbox"===e.type){if(e.closest("[data-minchecked], [data-maxchecked]"))return;const a=e.checkValidity()&&e.checked;return e.classList.toggle("is-valid",e.checked),e.checked||e.classList.remove("is-valid"),e.classList.toggle("is-invalid",t&&!a),void e.setAttribute("aria-invalid",t&&!a?"true":"false")}e.setCustomValidity("");const r=!e.checkValidity();null!=e.value&&""!==e.value.trim()||t||"blur"===a?r?(e.classList.remove("is-valid"),(t||"blur"===a||"change"===a)&&(e.classList.add("is-invalid"),n(e))):(e.classList.remove("is-invalid"),e.classList.add("is-valid"),e.setAttribute("aria-invalid","false")):e.classList.remove("is-valid","is-invalid")}!function(){const e=document.querySelectorAll("select[data-freeinput-on]");e.length&&e.forEach((e=>{const a=(e.dataset.freeinputOn||"").split("|").map((e=>e.trim())).filter(Boolean).map((e=>new RegExp(`^${e}$`,"i"))),n=e.closest(".mb-3, .form-group")||e.parentElement,s=document.createElement("input");s.type="text",s.className="form-control mt-2 rounded-4 shadow d-none js-freeinput-reason",s.placeholder=e.dataset.freeinputPlaceholder||"Please tell us more",s.name=(e.name||"detail")+"_reason",s.maxLength=160,n.appendChild(s),s.addEventListener("input",(()=>r(s,{from:"input"}))),s.addEventListener("change",(()=>r(s,{from:"change"}))),s.addEventListener("blur",(()=>r(s,{from:"blur"})));const i=(n="")=>{const r=e.options[e.selectedIndex],i=(e.value||"").trim(),o=(r?.text||"").trim();a.some((e=>e.test(i)||e.test(o)))?(s.classList.remove("d-none"),s.required=!0,void 0!==t&&t&&n&&s.dispatchEvent(new Event("blur",{bubbles:!0}))):(s.required=!1,s.value="",s.classList.add("d-none"),s.classList.remove("is-valid","is-invalid"),s.removeAttribute("aria-invalid"))};e.addEventListener("change",(()=>i("change"))),i()}))}(),function(){const t=e.querySelector("#safety_level"),a=e.querySelector("#safetyBadge");if(!t||!a)return;const n=()=>{a.textContent=`${t.value} / 10`};t.addEventListener("input",n),t.addEventListener("change",(()=>r(t,{from:"change"}))),n()}(),a.forEach((e=>{e.addEventListener("input",(()=>r(e,{from:"input"}))),e.addEventListener("change",(()=>r(e,{from:"change"}))),e.addEventListener("blur",(()=>r(e,{from:"blur"})))}));const s=Array.from(e.querySelectorAll(".form-step")),i=s.length>0,o=document.getElementById("progressBar");let l=0;const c=o?o.closest(".mb-3")||o.closest(".progress"):null;if(c&&(c.style.display="none",c.setAttribute("aria-hidden","true")),window.AOS&&!window.__AOS_READY__)try{AOS.init({once:!1}),window.__AOS_READY__=!0}catch{}function d(e){if(!i)return;if(s.forEach(((t,a)=>t.classList.toggle("d-none",a!==e))),l=e,o&&c)if(0===e)c.style.display="none",c.setAttribute("aria-hidden","true");else{c.style.display="",c.removeAttribute("aria-hidden");const t=Math.max(5,Math.round(e/(s.length-1)*100));o.style.width=t+"%",o.setAttribute("aria-valuenow",String(t))}try{window.scrollTo({top:0,behavior:"smooth"})}catch{}const t=s[e];!function(e){if(e&&(e.classList.remove("step-enter-active"),e.offsetWidth,e.classList.add("step-enter-active"),window.AOS)){const t=[];e.hasAttribute("data-aos")&&t.push(e),e.querySelectorAll("[data-aos]").forEach((e=>t.push(e))),t.forEach((e=>{e.classList.remove("aos-animate"),e.classList.remove("aos-init")})),e.offsetWidth;try{AOS.refreshHard()}catch{try{AOS.refresh()}catch{}}requestAnimationFrame((()=>window.dispatchEvent(new Event("scroll"))))}}(t);const a=t.querySelector("input, select, textarea, button");if(a)try{a.focus({preventScroll:!1})}catch{}}function u(e,t){const a=Number.isFinite(t);return e>0&&a?`Please select at least ${e} (max ${t}).`:e>0?`Please select at least ${e}.`:a?`Please select up to ${t}.`:""}const m=/^\s*not\s*sure\b/i;function h(e){return Array.from(e.querySelectorAll('input[type="checkbox"]')).find((e=>m.test(function(e){const t=e.closest(".form-check")?.querySelector("label");return((e.value||"")+" "+(t?.textContent||"")).trim()}(e))))}function f(e){const t=e.closest(".form-check")||e.parentElement;let a=t.querySelector(".js-notsure-input");return a||(a=function(e){const t=document.createElement("input");t.type="text",t.className="form-control mt-2 rounded-4 shadow js-notsure-input d-none",t.placeholder="Optional: tell us more";const a=(e||"notsure").replace(/\[\]$/,"");return t.name=`${a}_notsure_note`,t.maxLength=160,t}(e.name),t.appendChild(a),a.addEventListener("input",(()=>r(a,{from:"input"}))),a.addEventListener("change",(()=>r(a,{from:"change"}))),a.addEventListener("blur",(()=>r(a,{from:"blur"})))),a}function v(e){const a=h(e);if(!a)return;const n=f(a);a.checked?(n.classList.remove("d-none"),n.required=!0,t&&r(n,{from:"change"})):(n.required=!1,n.value="",n.classList.add("d-none"),n.classList.remove("is-valid","is-invalid"),n.removeAttribute("aria-invalid"))}function p(e,t=""){let a=e.querySelector(".group-feedback");return a||(a=e.querySelector(".invalid-feedback, .form-text")||document.createElement("div"),a.parentElement||e.appendChild(a)),a.className="group-feedback form-text text-muted",a.textContent=t,a.style.display="",a}function y(e,{showErrors:t=!1}={}){const a=Array.from(e.querySelectorAll('input[type="checkbox"]')),n=parseInt(e.dataset.minchecked||"0",10),r=e.dataset.maxchecked?parseInt(e.dataset.maxchecked,10):1/0,s=a.filter((e=>e.checked)),i=s.length>=n&&s.length<=r,o=s.length>r?`Please select no more than ${r}.`:`Please select at least ${n}.`;p(e,i?u(n,r):o).className=t&&!i?"group-feedback invalid-feedback d-block":"group-feedback form-text text-muted",a.forEach((e=>{i&&e.checked?e.classList.add("is-valid"):e.classList.remove("is-valid")}));const l=isFinite(r)&&s.length>=r;return a.forEach((e=>{e.checked||(l?e.disabled||(e.dataset.lockedByMax="1",e.disabled=!0):"1"===e.dataset.lockedByMax&&(e.disabled=!1,delete e.dataset.lockedByMax))})),e.setAttribute("aria-invalid",t&&!i?"true":"false"),i}function b(e=document,t={}){return Array.from(e.querySelectorAll("[data-minchecked], [data-maxchecked]")).every((e=>y(e,t)))}function g(){if(!i)return!0;const e=s[l];let a=!0,r=null;Array.from(e.querySelectorAll('input:not([type="checkbox"])[required], select[required], textarea[required]')).forEach((e=>{e.checkValidity()?function(e){e.classList.remove("is-invalid"),e.removeAttribute("aria-invalid");const t=e.closest(".mb-3, .form-group")||e.parentElement,a=t&&t.querySelector(".invalid-feedback");a&&(a.textContent=a.textContent)}(e):(a=!1,r||(r=e),n(e))}));const o=b(e,{showErrors:!0});if(a=o&&a,!o&&!r){const t=e.querySelector("[data-minchecked], [data-maxchecked]");t&&(r=t.querySelector('input[type="checkbox"]')||t)}if(!a&&(t=!0,r))try{r.focus({preventScroll:!1})}catch{}return a}function E(t){return e.querySelector(t)}function k(e){const t=E(e);return t&&"string"==typeof t.value?t.value.trim():""}function L(e){const t=E(`[name="${e}"]`);return t?(t.value||"").trim():""}function A(t){return(a=`[name="${t}"]:checked`,Array.from(e.querySelectorAll(a))).map((e=>e.value));var a}function S(){const t=k('[name="firstName"]')||k("#firstName")||"",a=k('[name="lastName"]')||k("#lastName")||"";let n=t,r=a;if(!t&&!a){const e=function(e){if(!e)return{first:"",last:""};const t=e.trim().split(/\s+/);return{first:t.shift()||"",last:t.join(" ")||""}}(k('[name="full_name"]')||k('[name*="Full Name"]')||"");n=e.first,r=e.last}const s=k('[name="email"]')||k("#email")||k('[name="Email Address"]')||k('input[type="email"]'),i=[n,r].filter(Boolean).join(" ").trim(),o=String(function(){let t=0;const a=L("risk_window");["Night","24/7","When I'm traveling"].includes(a)&&(t+=2),"Pretty dark"===L("night_lighting")&&(t+=1);const n=A("priority_areas[]");(n.length>=3||n.includes("Whole perimeter (360°)"))&&(t+=2),A("features_must[]").some((e=>/ColorVu|Human\/vehicle/.test(e)))&&(t+=1);const r=L("current_setup");("No Security System"===r||/Old System|outdated/i.test(r))&&(t+=1);const s=L("budget_band");/All I can need/i.test(s)&&(t+=2),/Feature Rich|Everything/i.test(s)&&(t+=3);const i=L("timeline");return"ASAP"!==i&&"This week"!==i&&"This month"!==i||(t+=3),"Me"===L("decision_makers")&&(t+=1),(E('[name="incident_notes"]')?.value||"").trim()&&(t+=1),Number(e.querySelector('[name="safety_level"]')?.value||0)<=3&&(t+=1),t}()),l=(c=Number(o))>=12?"Hot":c>=8?"Warm":"Nurture";var c;const d=function(){const e=[],t=L("risk_window"),a=L("night_lighting"),n=A("priority_areas[]"),r=A("features_must[]"),s=r.includes("30+ days storage")||r.includes("24/7 recording");return(["Night","24/7","When I'm traveling"].includes(t)||"Pretty dark"===a)&&e.push("Include ColorVu for full-color night imaging at key entries."),(n.includes("Gate/Driveway")||n.includes("Street view/Plates"))&&e.push("Consider varifocal/longer reach for driveway/street (plates)."),(n.length>=3||n.includes("Whole perimeter (360°)"))&&e.push("Plan 6–8 cams for 360° with minimal blind spots."),r.some((e=>/Human\/vehicle/.test(e)))&&e.push("Enable AcuSense human/vehicle smart alerts."),s&&e.push("Size HDD for 30+ days or 24/7 recording as requested."),e.join(" ")}();sessionStorage.setItem("autoReplyPayload",JSON.stringify({first:n,last:r,email:s,to_name:i,lead_score:o,lead_tier:l,auto_notes:d}));const u=e.querySelector("#lead_score"),m=e.querySelector("#lead_tier"),h=e.querySelector("#auto_notes");return u&&(u.value=o),m&&(m.value=l),h&&(h.value=d),localStorage.setItem("ssh_last_tier",l),localStorage.setItem("ssh_last_score",o),{lead_score:o,lead_tier:l,email:s,to_name:i}}document.addEventListener("change",(e=>{const a=e.target;if(a.matches('input[type="checkbox"]')){const e=a.closest("[data-minchecked], [data-maxchecked]");e?(!function(e,t){const a=h(e);a&&(t===a&&a.checked?e.querySelectorAll('input[type="checkbox"]').forEach((e=>{e!==a&&(e.checked=!1)})):a.checked&&t!==a&&t.checked&&(a.checked=!1),v(e))}(e,a),y(e,{showErrors:t})):(a.classList.toggle("is-valid",a.checked),a.checked||a.classList.remove("is-valid"))}else a.matches('select, input:not([type="checkbox"]), textarea')&&r(a,{from:"change"})})),e.querySelectorAll("[data-next]").forEach((e=>{e.addEventListener("click",(()=>{const e=s[l];if(!g())return t=!0,b(e,{showErrors:!0}),void Array.from(e.querySelectorAll("input, select, textarea")).forEach((e=>r(e,{from:"submit"})));d(Math.min(l+1,s.length-1))}))})),e.querySelectorAll("[data-prev]").forEach((e=>{e.addEventListener("click",(()=>{d(Math.max(l-1,0))}))})),Array.from(e.querySelectorAll("[data-minchecked], [data-maxchecked]")).forEach((e=>{!function(e){p(e,u(parseInt(e.dataset.minchecked||"0",10),e.dataset.maxchecked?parseInt(e.dataset.maxchecked,10):1/0)),e.removeAttribute("aria-invalid"),e.dataset.touched="0",e.querySelectorAll('input[type="checkbox"]').forEach((e=>{e.classList.remove("is-invalid","is-valid"),e.removeAttribute("aria-invalid"),e.removeAttribute("disabled")}));const t=h(e);t&&f(t),v(e)}(e);const t=h(e);t&&t.checked&&e.querySelectorAll('input[type="checkbox"]').forEach((e=>{e!==t&&(e.checked=!1)})),v(e)})),b(e,{showErrors:!1}),i&&d(0),function(){const e=/\b(others?|not\s*[-–—]?\s*sure)\b/i;function a(e,t,a="Please specify"){const n=document.createElement("input");n.type="text",n.className="form-control mt-2 rounded-4 shadow js-freeinput d-none",n.placeholder=a;const s=(t||e.name||"detail").replace(/\[\]$/,"");return n.name=`${s}_other`,n.maxLength=160,n.addEventListener("input",(()=>r(n,{from:"input"}))),n.addEventListener("change",(()=>r(n,{from:"change"}))),n.addEventListener("blur",(()=>r(n,{from:"blur"}))),n}document.querySelectorAll("select").forEach((function(n){if(!Array.from(n.options).some((t=>e.test((t.value||t.text||"").toLowerCase()))))return;const r=n.closest(".mb-3, .form-group")||n.parentElement,s=a(n,n.name,"Tell us more");(r||n).appendChild(s);const i=(a="")=>{const r=n.options[n.selectedIndex],i=((n.value||"")+" "+(r?.text||"")).toLowerCase(),o=e.test(i);/not\s*[-–—]?\s*sure/i.test(i)?s.placeholder="Optional: tell us more":s.placeholder="Please specify",o?(s.classList.remove("d-none"),s.required=!0,t&&a&&s.dispatchEvent(new Event("blur",{bubbles:!0}))):(s.required=!1,s.value="",s.classList.add("d-none"),s.classList.remove("is-valid","is-invalid"),s.removeAttribute("aria-invalid"))};n.addEventListener("change",(()=>i("change"))),i()})),document.querySelectorAll('input[type="checkbox"], input[type="radio"]').forEach((function(e){const n=e.closest(".form-check")?.querySelector("label"),r=((e.value||"")+" "+(n?.textContent||"")).trim();if(!/\bothers?\b/i.test(r))return;const s=e.closest(".form-check")||e.parentElement,i=a(e,e.name,"Please specify");s.appendChild(i);const o=(a="")=>{e.checked?(i.classList.remove("d-none"),i.required=!0,t&&a&&i.dispatchEvent(new Event("blur",{bubbles:!0}))):(i.required=!1,i.value="",i.classList.add("d-none"),i.classList.remove("is-valid","is-invalid"),i.removeAttribute("aria-invalid"))};e.addEventListener("change",(()=>o("change"))),o()}))}(),e.addEventListener("submit",(n=>{if(i&&!g())return n.preventDefault(),n.stopPropagation(),void(t=!0);if(!e.checkValidity()){n.preventDefault(),n.stopPropagation(),t=!0,a.forEach((e=>r(e,{from:"submit"})));const s=e.querySelector(".is-invalid, :invalid");return void(s&&s.focus())}const s=S();try{const t=e.getAttribute("data-bss-redirect-url")||"thank-you.html",a=new URL(t,location.origin);s&&s.lead_tier&&a.searchParams.set("tier",s.lead_tier),s&&s.lead_score&&a.searchParams.set("score",s.lead_score),e.setAttribute("data-bss-redirect-url",a.pathname+a.search)}catch(n){}}))}));