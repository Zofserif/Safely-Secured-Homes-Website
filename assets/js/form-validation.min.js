document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("myForm");if(!e)return;!function(e=".js-name"){const t=document.querySelectorAll(e);if(!t.length)return;const a=/[^\p{L}\p{M}\s'’-]/gu,n=/[^A-Za-z\s'’-]/g,r=e=>{if(null==e)return"";let t=e.normalize?e.normalize("NFC"):e;try{t=t.replace(a,"")}catch{t=t.replace(n,"")}return t.replace(/\s{2,}/g," ")},i=(e,t)=>{const a=e.selectionStart??e.value.length,n=e.selectionEnd??e.value.length;e.value=e.value.slice(0,a)+t+e.value.slice(n);const r=a+t.length;try{e.setSelectionRange(r,r)}catch{}e.dispatchEvent(new Event("input",{bubbles:!0}))};t.forEach((e=>{e.setAttribute("inputmode","text"),e.setAttribute("autocomplete",e.id?.toLowerCase().includes("last")?"family-name":"given-name"),e.addEventListener("beforeinput",(e=>{if(!e.data)return;r(e.data)!==e.data&&e.preventDefault()})),e.addEventListener("input",(()=>{const t=r(e.value);if(e.value!==t){const a=e.selectionStart??t.length,n=e.value.length-t.length;e.value=t;try{e.setSelectionRange(Math.max(0,a-n),Math.max(0,a-n))}catch{}}})),e.addEventListener("paste",(t=>{t.preventDefault();const a=(t.clipboardData||window.clipboardData).getData("text");i(e,r(a))})),e.addEventListener("drop",(t=>{t.preventDefault();const a=t.dataTransfer?.getData("text")??"";i(e,r(a))}))}))}(),e.setAttribute("novalidate","");let t=!1;const a=Array.from(e.querySelectorAll("input, textarea, select"));function n(e){e.classList.add("is-invalid"),e.setAttribute("aria-invalid","true"),function(e,t="Please fill out this field."){const a=e.closest(".mb-3, .form-group")||e.parentElement;if(!a)return null;let n=a.querySelector(".invalid-feedback");n||(n=document.createElement("div"),n.className="invalid-feedback",a.appendChild(n));const r="email"===e.type?"Please enter a valid email address.":"tel"===e.type?"Please enter a valid mobile number.":"SELECT"===e.tagName?"Please choose an option.":t;n.textContent=r}(e)}function r(e,{from:a=""}={}){if(e.disabled||e.readOnly)return;if("checkbox"===e.type){if(e.closest("[data-minchecked], [data-maxchecked]"))return;const a=e.checkValidity()&&e.checked;return e.classList.toggle("is-valid",e.checked),e.checked||e.classList.remove("is-valid"),e.classList.toggle("is-invalid",t&&!a),void e.setAttribute("aria-invalid",t&&!a?"true":"false")}e.setCustomValidity("");const r=!e.checkValidity();null!=e.value&&""!==e.value.trim()||t||"blur"===a?r?(e.classList.remove("is-valid"),(t||"blur"===a||"change"===a)&&(e.classList.add("is-invalid"),n(e))):(e.classList.remove("is-invalid"),e.classList.add("is-valid"),e.setAttribute("aria-invalid","false")):e.classList.remove("is-valid","is-invalid")}!function(){const e=document.querySelectorAll("select[data-freeinput-on]");e.length&&e.forEach((e=>{const a=(e.dataset.freeinputOn||"").split("|").map((e=>e.trim())).filter(Boolean).map((e=>new RegExp(`^${e}$`,"i"))),n=e.closest(".mb-3, .form-group")||e.parentElement,i=document.createElement("input");i.type="text",i.className="form-control mt-2 rounded-4 shadow d-none js-freeinput-reason",i.placeholder=e.dataset.freeinputPlaceholder||"Please tell us more",i.name=(e.name||"detail")+"_reason",i.maxLength=160,n.appendChild(i),i.addEventListener("input",(()=>r(i,{from:"input"}))),i.addEventListener("change",(()=>r(i,{from:"change"}))),i.addEventListener("blur",(()=>r(i,{from:"blur"})));const s=(n="")=>{const r=e.options[e.selectedIndex],s=(e.value||"").trim(),c=(r?.text||"").trim();a.some((e=>e.test(s)||e.test(c)))?(i.classList.remove("d-none"),i.required=!0,void 0!==t&&t&&n&&i.dispatchEvent(new Event("blur",{bubbles:!0}))):(i.required=!1,i.value="",i.classList.add("d-none"),i.classList.remove("is-valid","is-invalid"),i.removeAttribute("aria-invalid"))};e.addEventListener("change",(()=>s("change"))),s()}))}(),function(){const t=e.querySelector("#safety_level"),a=e.querySelector("#safetyBadge");if(!t||!a)return;const n=()=>{a.textContent=`${t.value} / 10`};t.addEventListener("input",n),t.addEventListener("change",(()=>r(t,{from:"change"}))),n()}(),a.forEach((e=>{e.addEventListener("input",(()=>r(e,{from:"input"}))),e.addEventListener("change",(()=>r(e,{from:"change"}))),e.addEventListener("blur",(()=>r(e,{from:"blur"})))}));const i=Array.from(e.querySelectorAll(".form-step")),s=i.length>0,c=document.getElementById("progressBar");let o=0;const l=c?c.closest(".mb-3")||c.closest(".progress"):null;if(l&&(l.style.display="none",l.setAttribute("aria-hidden","true")),window.AOS&&!window.__AOS_READY__)try{AOS.init({once:!1}),window.__AOS_READY__=!0}catch{}function d(e){if(!s)return;if(i.forEach(((t,a)=>t.classList.toggle("d-none",a!==e))),o=e,c&&l)if(0===e)l.style.display="none",l.setAttribute("aria-hidden","true");else{l.style.display="",l.removeAttribute("aria-hidden");const t=Math.max(5,Math.round(e/(i.length-1)*100));c.style.width=t+"%",c.setAttribute("aria-valuenow",String(t))}try{window.scrollTo({top:0,behavior:"smooth"})}catch{}const t=i[e];!function(e){if(e&&(e.classList.remove("step-enter-active"),e.offsetWidth,e.classList.add("step-enter-active"),window.AOS)){const t=[];e.hasAttribute("data-aos")&&t.push(e),e.querySelectorAll("[data-aos]").forEach((e=>t.push(e))),t.forEach((e=>{e.classList.remove("aos-animate"),e.classList.remove("aos-init")})),e.offsetWidth;try{AOS.refreshHard()}catch{try{AOS.refresh()}catch{}}requestAnimationFrame((()=>window.dispatchEvent(new Event("scroll"))))}}(t);const a=t.querySelector("input, select, textarea, button");if(a)try{a.focus({preventScroll:!1})}catch{}}function u(e,t){const a=Number.isFinite(t);return e>0&&a?`Please select at least ${e} (max ${t}).`:e>0?`Please select at least ${e}.`:a?`Please select up to ${t}.`:""}const m=/^\s*not\s*sure\b/i;function h(e){return Array.from(e.querySelectorAll('input[type="checkbox"]')).find((e=>m.test(function(e){const t=e.closest(".form-check")?.querySelector("label");return((e.value||"")+" "+(t?.textContent||"")).trim()}(e))))}function f(e){const t=e.closest(".form-check")||e.parentElement;let a=t.querySelector(".js-notsure-input");return a||(a=function(e){const t=document.createElement("input");t.type="text",t.className="form-control mt-2 rounded-4 shadow js-notsure-input d-none",t.placeholder="Optional: tell us more";const a=(e||"notsure").replace(/\[\]$/,"");return t.name=`${a}_notsure_note`,t.maxLength=160,t}(e.name),t.appendChild(a),a.addEventListener("input",(()=>r(a,{from:"input"}))),a.addEventListener("change",(()=>r(a,{from:"change"}))),a.addEventListener("blur",(()=>r(a,{from:"blur"})))),a}function v(e){const a=h(e);if(!a)return;const n=f(a);a.checked?(n.classList.remove("d-none"),n.required=!0,t&&r(n,{from:"change"})):(n.required=!1,n.value="",n.classList.add("d-none"),n.classList.remove("is-valid","is-invalid"),n.removeAttribute("aria-invalid"))}function p(e,t=""){let a=e.querySelector(".group-feedback");return a||(a=e.querySelector(".invalid-feedback, .form-text")||document.createElement("div"),a.parentElement||e.appendChild(a)),a.className="group-feedback form-text text-muted",a.textContent=t,a.style.display="",a}function y(e,{showErrors:t=!1}={}){const a=Array.from(e.querySelectorAll('input[type="checkbox"]')),n=parseInt(e.dataset.minchecked||"0",10),r=e.dataset.maxchecked?parseInt(e.dataset.maxchecked,10):1/0,i=a.filter((e=>e.checked)),s=i.length>=n&&i.length<=r,c=i.length>r?`Please select no more than ${r}.`:`Please select at least ${n}.`;p(e,s?u(n,r):c).className=t&&!s?"group-feedback invalid-feedback d-block":"group-feedback form-text text-muted",a.forEach((e=>{s&&e.checked?e.classList.add("is-valid"):e.classList.remove("is-valid")}));const o=isFinite(r)&&i.length>=r;return a.forEach((e=>{e.checked||(o?e.disabled||(e.dataset.lockedByMax="1",e.disabled=!0):"1"===e.dataset.lockedByMax&&(e.disabled=!1,delete e.dataset.lockedByMax))})),e.setAttribute("aria-invalid",t&&!s?"true":"false"),s}function b(e=document,t={}){return Array.from(e.querySelectorAll("[data-minchecked], [data-maxchecked]")).every((e=>y(e,t)))}function g(){if(!s)return!0;const e=i[o];let a=!0,r=null;Array.from(e.querySelectorAll('input:not([type="checkbox"])[required], select[required], textarea[required]')).forEach((e=>{e.checkValidity()?function(e){e.classList.remove("is-invalid"),e.removeAttribute("aria-invalid");const t=e.closest(".mb-3, .form-group")||e.parentElement,a=t&&t.querySelector(".invalid-feedback");a&&(a.textContent=a.textContent)}(e):(a=!1,r||(r=e),n(e))}));const c=b(e,{showErrors:!0});if(a=c&&a,!c&&!r){const t=e.querySelector("[data-minchecked], [data-maxchecked]");t&&(r=t.querySelector('input[type="checkbox"]')||t)}if(!a&&(t=!0,r))try{r.focus({preventScroll:!1})}catch{}return a}function E(t){return e.querySelector(t)}function k(e){const t=E(e);return t&&"string"==typeof t.value?t.value.trim():""}function x(e){const t=E(`[name="${e}"]`);return t?(t.value||"").trim():""}function L(t){return(a=`[name="${t}"]:checked`,Array.from(e.querySelectorAll(a))).map((e=>e.value));var a}function S(){let t=0;const a=x("risk_window");["Night","24/7","When I'm traveling"].includes(a)&&(t+=2);"Pretty dark"===x("night_lighting")&&(t+=1);const n=L("priority_areas[]");(n.length>=3||n.includes("Whole perimeter (360°)"))&&(t+=2);L("features_must[]").some((e=>/ColorVu|Human\/vehicle/.test(e)))&&(t+=1);const r=x("current_setup");("No Security System"===r||/Old System|outdated/i.test(r))&&(t+=1);const i=x("budget_band");/All I can need/i.test(i)&&(t+=2),/Feature Rich|Everything/i.test(i)&&(t+=3);const s=x("timeline");"ASAP"!==s&&"This week"!==s&&"This month"!==s||(t+=3);"Me"===x("decision_makers")&&(t+=1);(E('[name="incident_notes"]')?.value||"").trim()&&(t+=1);return Number(e.querySelector('[name="safety_level"]')?.value||0)<=3&&(t+=1),t}function A(e){return e>=12?"Hot":e>=8?"Warm":"Nurture"}function _(){const e=[],t=x("risk_window"),a=x("night_lighting"),n=L("priority_areas[]"),r=L("features_must[]"),i=r.includes("30+ days storage")||r.includes("24/7 recording");return(["Night","24/7","When I'm traveling"].includes(t)||"Pretty dark"===a)&&e.push("Include ColorVu for full-color night imaging at key entries."),(n.includes("Gate/Driveway")||n.includes("Street view/Plates"))&&e.push("Consider varifocal/longer reach for driveway/street (plates)."),(n.length>=3||n.includes("Whole perimeter (360°)"))&&e.push("Plan 6–8 cams for 360° with minimal blind spots."),r.some((e=>/Human\/vehicle/.test(e)))&&e.push("Enable AcuSense human/vehicle smart alerts."),i&&e.push("Size HDD for 30+ days or 24/7 recording as requested."),e.join(" ")}function q(e){const t=Number(e)||0;return t<=4?4:t<=8?8:16}function w(){const e=[{rx:/garage/i,label:"Garage interior",inc:1},{rx:/backyard|patio/i,label:"Backyard/Patio",inc:1},{rx:/side\s*gates?|fence/i,label:"Side gates/Fence line",inc:1},{rx:/street|plates?/i,label:"Street view/Plates",inc:1},{rx:/main\s*hall|living/i,label:"Main hall/Living (indoor)",inc:1},{rx:/whole|360/i,label:"Whole perimeter (360°)",inc:2}],t=x("home_size")||x("floors"),a=x("floors"),n=L("priority_areas[]");let r=2;const i=[{match:/extra\s*large/i,inc:2},{match:/large/i,inc:1}].find((e=>e.match.test(t||"")));i&&(r+=i.inc);const s=[{match:/^\s*3\s*\+?$/i,inc:2},{match:/^\s*2\s*$/i,inc:1}].find((e=>e.match.test(a||"")));s&&(r+=s.inc);const c=["Front door/porch","Gate/Driveway"];return n.forEach((t=>{const a=e.find((e=>e.rx.test(t)));a&&(r+=a.inc,c.includes(a.label)||c.push(a.label))})),{cameraCount:r,cameraRecommendedLocations:c.join(", "),nvrChannel:q(r)}}function C(e){if(!e)return{first:"",last:""};const t=e.trim().split(/\s+/);return{first:t.shift()||"",last:t.join(" ")||""}}function w(){const e=[{rx:/garage/i,label:"Garage interior",inc:1},{rx:/backyard|patio/i,label:"Backyard/Patio",inc:1},{rx:/side\s*gates?|fence/i,label:"Side gates/Fence line",inc:1},{rx:/street|plates?/i,label:"Street view/Plates",inc:1},{rx:/main\s*hall|living/i,label:"Main hall/Living (indoor)",inc:1},{rx:/whole|360/i,label:"Whole perimeter (360°)",inc:2}],t=x("home_size")||x("floors"),a=x("floors"),n=L("priority_areas[]");let r=2;const i=[{match:/extra\s*large/i,inc:2},{match:/large/i,inc:1}].find((e=>e.match.test(t||"")));i&&(r+=i.inc);const s=[{match:/^\s*3\s*\+?$/i,inc:2},{match:/^\s*2\s*$/i,inc:1}].find((e=>e.match.test(a||"")));s&&(r+=s.inc);const c=["Front door/porch","Gate/Driveway"];n.forEach((t=>{const a=e.find((e=>e.rx.test(t)));a&&(r+=a.inc,c.includes(a.label)||c.push(a.label))}));const o=r<=4?4:r<=8?8:16;return{cameraCount:r,cameraRecommendedLocations:c.join(", "),nvrChannel:o}}document.addEventListener("change",(e=>{const a=e.target;if(a.matches('input[type="checkbox"]')){const e=a.closest("[data-minchecked], [data-maxchecked]");e?(!function(e,t){const a=h(e);a&&(t===a&&a.checked?e.querySelectorAll('input[type="checkbox"]').forEach((e=>{e!==a&&(e.checked=!1)})):a.checked&&t!==a&&t.checked&&(a.checked=!1),v(e))}(e,a),y(e,{showErrors:t})):(a.classList.toggle("is-valid",a.checked),a.checked||a.classList.remove("is-valid"))}else a.matches('select, input:not([type="checkbox"]), textarea')&&r(a,{from:"change"})})),e.querySelectorAll("[data-next]").forEach((e=>{e.addEventListener("click",(()=>{const e=i[o];if(!g())return t=!0,b(e,{showErrors:!0}),void Array.from(e.querySelectorAll("input, select, textarea")).forEach((e=>r(e,{from:"submit"})));d(Math.min(o+1,i.length-1))}))})),e.querySelectorAll("[data-prev]").forEach((e=>{e.addEventListener("click",(()=>{d(Math.max(o-1,0))}))})),Array.from(e.querySelectorAll("[data-minchecked], [data-maxchecked]")).forEach((e=>{!function(e){p(e,u(parseInt(e.dataset.minchecked||"0",10),e.dataset.maxchecked?parseInt(e.dataset.maxchecked,10):1/0)),e.removeAttribute("aria-invalid"),e.dataset.touched="0",e.querySelectorAll('input[type="checkbox"]').forEach((e=>{e.classList.remove("is-invalid","is-valid"),e.removeAttribute("aria-invalid"),e.removeAttribute("disabled")}));const t=h(e);t&&f(t),v(e)}(e);const t=h(e);t&&t.checked&&e.querySelectorAll('input[type="checkbox"]').forEach((e=>{e!==t&&(e.checked=!1)})),v(e)})),b(e,{showErrors:!1}),s&&d(0),function(){const e=/\b(others?|not\s*[-–—]?\s*sure)\b/i;function a(e,t,a="Please specify"){const n=document.createElement("input");n.type="text",n.className="form-control mt-2 rounded-4 shadow js-freeinput d-none",n.placeholder=a;const i=(t||e.name||"detail").replace(/\[\]$/,"");return n.name=`${i}_other`,n.maxLength=160,n.addEventListener("input",(()=>r(n,{from:"input"}))),n.addEventListener("change",(()=>r(n,{from:"change"}))),n.addEventListener("blur",(()=>r(n,{from:"blur"}))),n}document.querySelectorAll("select").forEach((function(n){if(!Array.from(n.options).some((t=>e.test((t.value||t.text||"").toLowerCase()))))return;const r=n.closest(".mb-3, .form-group")||n.parentElement,i=a(n,n.name,"Tell us more");(r||n).appendChild(i);const s=(a="")=>{const r=n.options[n.selectedIndex],s=((n.value||"")+" "+(r?.text||"")).toLowerCase(),c=e.test(s);/not\s*[-–—]?\s*sure/i.test(s)?i.placeholder="Optional: tell us more":i.placeholder="Please specify",c?(i.classList.remove("d-none"),i.required=!0,t&&a&&i.dispatchEvent(new Event("blur",{bubbles:!0}))):(i.required=!1,i.value="",i.classList.add("d-none"),i.classList.remove("is-valid","is-invalid"),i.removeAttribute("aria-invalid"))};n.addEventListener("change",(()=>s("change"))),s()})),document.querySelectorAll('input[type="checkbox"], input[type="radio"]').forEach((function(e){const n=e.closest(".form-check")?.querySelector("label"),r=((e.value||"")+" "+(n?.textContent||"")).trim();if(!/\bothers?\b/i.test(r))return;const i=e.closest(".form-check")||e.parentElement,s=a(e,e.name,"Please specify");i.appendChild(s);const c=(a="")=>{e.checked?(s.classList.remove("d-none"),s.required=!0,t&&a&&s.dispatchEvent(new Event("blur",{bubbles:!0}))):(s.required=!1,s.value="",s.classList.add("d-none"),s.classList.remove("is-valid","is-invalid"),s.removeAttribute("aria-invalid"))};e.addEventListener("change",(()=>c("change"))),c()}))}(),e.addEventListener("submit",(n=>{if(s&&!g())return n.preventDefault(),n.stopPropagation(),void(t=!0);if(!e.checkValidity()){n.preventDefault(),n.stopPropagation(),t=!0,a.forEach((e=>r(e,{from:"submit"})));const i=e.querySelector(".is-invalid, :invalid");return void(i&&i.focus())}const i=function(){const t=k('[name="firstName"]')||k("#firstName")||"",a=k('[name="lastName"]')||k("#lastName")||"";let n=t,r=a;if(!t&&!a){const e=C(k('[name="full_name"]')||k('[name*="Full Name"]')||"");n=e.first,r=e.last}const i=k('[name="email"]')||k("#email")||k('[name="Email Address"]')||k('input[type="email"]'),s=[n,r].filter(Boolean).join(" ").trim(),c=String(S()),o=A(Number(c)),l=_(),d=w();sessionStorage.setItem("autoReplyPayload",JSON.stringify({first:n,last:r,email:i,to_name:s,lead_score:c,lead_tier:o,auto_notes:l,cameraCount:d.cameraCount,cameraRecommendedLocations:d.cameraRecommendedLocations,nvrChannel:d.nvrChannel}));const u=e.querySelector("#lead_score"),m=e.querySelector("#lead_tier"),h=e.querySelector("#auto_notes");return u&&(u.value=c),m&&(m.value=o),h&&(h.value=l),localStorage.setItem("ssh_last_tier",o),localStorage.setItem("ssh_last_score",c),{lead_score:c,lead_tier:o,email:i,to_name:s}}();try{const t=e.getAttribute("data-bss-redirect-url")||"thank-you.html",a=new URL(t,location.origin);i&&i.lead_tier&&a.searchParams.set("tier",i.lead_tier),i&&i.lead_score&&a.searchParams.set("score",i.lead_score),e.setAttribute("data-bss-redirect-url",a.pathname+a.search)}catch(n){}}))}));