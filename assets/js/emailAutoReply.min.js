!function(){const t="SmP6rTJP04ORTpVg5",e="template_6zkfgcq",n="results.html",o=400,a="emailjs_sent:template_6zkfgcq";function i(t){(function(){let t=document.getElementById("status");return t||(t=document.createElement("p"),t.id="status",t.className="muted",t.setAttribute("aria-live","polite"),document.body.appendChild(t)),t}()).textContent=t||""}function s(t){if(Array.isArray(t))return t.map((t=>`• ${String(t).trim()}`)).join("\n");const e=String(t||"").trim();return e?e.split(/[\n,;]+/).map((t=>t.trim())).filter(Boolean).map((t=>`• ${t}`)).join("\n"):""}function r(){try{const t=sessionStorage.getItem("autoReplyPayload")||"{}";localStorage.setItem("autoReplyPayload",t);const e=btoa(encodeURIComponent(t)),o=new URL(n,location.href);o.hash="p="+e,location.assign(o.toString())}catch(t){location.assign(n)}}async function m(){const n=document.getElementById("continueBtn");n&&n.addEventListener("click",r);const m=function(){try{const t=sessionStorage.getItem("autoReplyPayload");return t?JSON.parse(t):null}catch{return null}}();if("1"===sessionStorage.getItem(a))return i("Taking you to your results…"),setTimeout(r,o);if(!m)return i("We couldn't find your answers. Taking you to your results…"),setTimeout(r,o);if(!m.email)return i("Missing email address. Taking you to your results…"),setTimeout(r,o);const c=function(t){const e=(t.to_name||[t.first,t.last].filter(Boolean).join(" ")).trim(),n=(t.first||e.split(/\s+/)[0]||"").trim(),o=(t.last||e.replace(new RegExp("^"+n+"\\b"),"").trim()).trim();return{to_email:t.email||"",email:t.email||"",to_name:e,first:n,last:o,firstname:n,first_name:n,firstName:n,lastname:o,last_name:o,lastName:o,lead_tier:t.lead_tier||"",lead_score:t.lead_score||"",auto_notes:t.auto_notes||"",camera_count:t.cameraCount||0,camera_locations:t.cameraRecommendedLocations||t.camera_locations||"",camera_locations_md:s(t.cameraRecommendedLocations||t.camera_locations||""),nvr_channel:t.nvrChannel||0}}(m);try{i("Sending your consultation summary…");const n=await new Promise(((e,n)=>{if(window.emailjs&&window.emailjs.send){try{window.emailjs.init(t)}catch(t){}return e(window.emailjs)}const o=document.createElement("script");o.src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js",o.async=!0,o.onload=function(){try{window.emailjs.init(t),e(window.emailjs)}catch(t){n(t)}},o.onerror=()=>n(new Error("Failed to load EmailJS SDK")),document.head.appendChild(o)}));await n.send("service_6tzmz2d",e,c),sessionStorage.setItem(a,"1"),i("Email sent! Redirecting to your results…"),setTimeout(r,o)}catch(t){console.error("[EmailJS] send failed:",t),i("Sorry—there was a problem sending your email."),function(){const t=document.getElementById("continueBtn");t&&t.classList.remove("d-none")}()}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",m):m()}();